{% extends 'core/admin_base.html' %}
{% load static %}
{% load admin_tags %}

{% block title %}Super Admin Dashboard - Library Management System{% endblock %}
{% block breadcrumb_title %}Dashboard{% endblock %}
{% block page_title %}Super Admin Dashboard{% endblock %}

{% block page_actions %}
<a href="{% url 'libraries:create_library' %}" class="admin-pro-btn admin-pro-btn-primary">
    <i class="fas fa-plus"></i> Add Library
</a>
<a href="{% url 'admin:accounts_user_add' %}" class="admin-pro-btn admin-pro-btn-outline">
    <i class="fas fa-user-plus"></i> Add User
</a>
{% endblock %}

{% block content %}
<div class="admin-pro-welcome-message mb-4">
    <div class="admin-pro-welcome-icon">
        <i class="fas fa-tachometer-alt"></i>
    </div>
    <div class="admin-pro-welcome-content">
        <h2>Welcome back, {{ user.get_full_name|default:"Super Admin" }}!</h2>
        <p>Here's what's happening across your library network today.</p>
    </div>
</div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="admin-pro-card">
                <div class="admin-pro-stats-card primary">
                    <div class="admin-pro-stats-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="admin-pro-stats-content">
                        <h3 class="admin-pro-stats-value">{{ libraries.count }}</h3>
                        <p class="admin-pro-stats-label">Total Libraries</p>
                        <div class="admin-pro-stats-trend up">
                            <i class="fas fa-arrow-up"></i> 5% from last month
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-pro-card">
                <div class="admin-pro-stats-card info">
                    <div class="admin-pro-stats-icon" style="background: linear-gradient(135deg, #3498db 0%, #5dade2 100%);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="admin-pro-stats-content">
                        <h3 class="admin-pro-stats-value">{{ total_users }}</h3>
                        <p class="admin-pro-stats-label">Total Users</p>
                        <div class="admin-pro-stats-trend up">
                            <i class="fas fa-arrow-up"></i> 12% from last month
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-pro-card">
                <div class="admin-pro-stats-card success">
                    <div class="admin-pro-stats-icon" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="admin-pro-stats-content">
                        <h3 class="admin-pro-stats-value">{{ total_transactions }}</h3>
                        <p class="admin-pro-stats-label">Transactions</p>
                        <div class="admin-pro-stats-trend up">
                            <i class="fas fa-arrow-up"></i> 8% from last month
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-pro-card">
                <div class="admin-pro-stats-card warning">
                    <div class="admin-pro-stats-icon" style="background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="admin-pro-stats-content">
                        <h3 class="admin-pro-stats-value">{{ libraries.filter.is_active.count }}</h3>
                        <p class="admin-pro-stats-label">Active Libraries</p>
                        <div class="admin-pro-stats-trend up">
                            <i class="fas fa-arrow-up"></i> 3% from last month
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="admin-pro-card">
                <div class="admin-pro-card-header">
                    <h3 class="admin-pro-card-title">
                        <i class="fas fa-bolt me-2 text-warning"></i>Quick Actions
                    </h3>
                </div>
                <div class="admin-pro-card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'libraries:manage_libraries' %}" class="admin-pro-action-card">
                                <div class="admin-pro-action-icon bg-primary">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="admin-pro-action-content">
                                    <h4>Manage Libraries</h4>
                                    <p>Add, edit or remove libraries</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'admin:accounts_user_changelist' %}" class="admin-pro-action-card">
                                <div class="admin-pro-action-icon bg-info">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="admin-pro-action-content">
                                    <h4>Manage Users</h4>
                                    <p>Add, edit or remove users</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'admin:books_book_changelist' %}" class="admin-pro-action-card">
                                <div class="admin-pro-action-icon bg-success">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="admin-pro-action-content">
                                    <h4>Manage Books</h4>
                                    <p>Add, edit or remove books</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'transactions:transaction_reports' %}" class="admin-pro-action-card">
                                <div class="admin-pro-action-icon bg-warning">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="admin-pro-action-content">
                                    <h4>View Reports</h4>
                                    <p>View transaction reports</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Libraries List -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="admin-pro-card">
                <div class="admin-pro-card-header d-flex justify-content-between align-items-center">
                    <h3 class="admin-pro-card-title">
                        <i class="fas fa-building me-2 text-primary"></i>Libraries
                    </h3>
                    <div class="admin-pro-card-actions">
                        <a href="{% url 'libraries:create_library' %}" class="admin-pro-btn admin-pro-btn-sm admin-pro-btn-primary">
                            <i class="fas fa-plus"></i> Add Library
                        </a>
                        <a href="{% url 'libraries:manage_libraries' %}" class="admin-pro-btn admin-pro-btn-sm admin-pro-btn-outline">
                            <i class="fas fa-cog"></i> Manage All
                        </a>
                    </div>
                </div>
                <div class="admin-pro-card-body">
                    <div class="admin-pro-table-container">
                        <table class="admin-pro-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Location</th>
                                    <th>Admin</th>
                                    <th>Books</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for library in libraries|slice:":5" %}
                                    <tr>
                                        <td>
                                            <div class="admin-pro-table-item">
                                                <div class="admin-pro-table-item-img">
                                                    {% if library.image %}
                                                        <img src="{{ library.image.url }}" alt="{{ library.name }}">
                                                    {% else %}
                                                        <div class="admin-pro-table-item-placeholder">
                                                            {{ library.name|slice:":1" }}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <div class="admin-pro-table-item-content">
                                                    <h4>{{ library.name }}</h4>
                                                    <p>ID: #{{ library.id }}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{{ library.city }}, {{ library.country }}</td>
                                        <td>
                                            {% if library.admin %}
                                                <div class="admin-pro-user-small">
                                                    <div class="admin-pro-user-small-img">
                                                        {% if library.admin.profile_picture %}
                                                            <img src="{{ library.admin.profile_picture.url }}" alt="{{ library.admin.get_full_name }}">
                                                        {% else %}
                                                            <div class="admin-pro-user-small-placeholder">
                                                                {{ library.admin.get_initials }}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="admin-pro-user-small-content">
                                                        {{ library.admin.get_full_name|default:library.admin.email }}
                                                    </div>
                                                </div>
                                            {% else %}
                                                <span class="admin-pro-badge admin-pro-badge-warning">Not assigned</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ library.book_copies.count }}</td>
                                        <td>
                                            {% if library.is_active %}
                                                <span class="admin-pro-badge admin-pro-badge-success">Active</span>
                                            {% else %}
                                                <span class="admin-pro-badge admin-pro-badge-danger">Inactive</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="admin-pro-table-actions">
                                                <a href="{% url 'libraries:manage_library' slug=library.slug %}" class="admin-pro-btn admin-pro-btn-sm admin-pro-btn-primary admin-pro-btn-icon" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'libraries:library_detail' slug=library.slug %}" class="admin-pro-btn admin-pro-btn-sm admin-pro-btn-info admin-pro-btn-icon" title="View">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center">No libraries available.</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if libraries.count > 5 %}
                        <div class="admin-pro-card-footer text-center">
                            <a href="{% url 'libraries:manage_libraries' %}" class="admin-pro-btn admin-pro-btn-outline">
                                View All Libraries ({{ libraries.count }})
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- System Information and Recent Activity -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="admin-pro-card">
                <div class="admin-pro-card-header">
                    <h3 class="admin-pro-card-title">
                        <i class="fas fa-server me-2 text-info"></i>System Information
                    </h3>
                </div>
                <div class="admin-pro-card-body">
                    <div class="admin-pro-info-list">
                        <div class="admin-pro-info-item">
                            <div class="admin-pro-info-label">
                                <i class="fab fa-python me-2"></i>
                                Python Version
                            </div>
                            <div class="admin-pro-info-value">
                                <span class="admin-pro-badge admin-pro-badge-info">{{ python_version }}</span>
                            </div>
                        </div>
                        <div class="admin-pro-info-item">
                            <div class="admin-pro-info-label">
                                <i class="fab fa-django me-2"></i>
                                Django Version
                            </div>
                            <div class="admin-pro-info-value">
                                <span class="admin-pro-badge admin-pro-badge-info">{% get_django_version %}</span>
                            </div>
                        </div>
                        <div class="admin-pro-info-item">
                            <div class="admin-pro-info-label">
                                <i class="fas fa-database me-2"></i>
                                Database Engine
                            </div>
                            <div class="admin-pro-info-value">
                                <span class="admin-pro-badge admin-pro-badge-info">{{ database_engine }}</span>
                            </div>
                        </div>
                        <div class="admin-pro-info-item">
                            <div class="admin-pro-info-label">
                                <i class="fas fa-clock me-2"></i>
                                Server Time
                            </div>
                            <div class="admin-pro-info-value">
                                <span class="admin-pro-badge admin-pro-badge-info">{% now "F j, Y H:i" %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="admin-pro-card">
                <div class="admin-pro-card-header">
                    <h3 class="admin-pro-card-title">
                        <i class="fas fa-history me-2 text-warning"></i>Recent Activity
                    </h3>
                </div>
                <div class="admin-pro-card-body">
                    <div class="admin-pro-activity-feed">
                        {% for log in recent_logs %}
                            <div class="admin-pro-activity-item">
                                <div class="admin-pro-activity-icon">
                                    <i class="fas fa-circle"></i>
                                </div>
                                <div class="admin-pro-activity-content">
                                    <div class="admin-pro-activity-message">{{ log.message }}</div>
                                    <div class="admin-pro-activity-time">{{ log.timestamp }}</div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="admin-pro-empty-state">
                                <div class="admin-pro-empty-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <h4>No Recent Activity</h4>
                                <p>Activity logs will appear here as you use the system.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
