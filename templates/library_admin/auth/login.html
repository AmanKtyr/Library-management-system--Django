{% extends "base.html" %}
{% load i18n %}
{% load account socialaccount %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans "Admin Login" %}{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="admin-login-container">
  <!-- Theme Toggle Button -->
  <div class="theme-toggle" id="themeToggle">
    <i class="fas fa-moon"></i>
  </div>

  <div class="admin-login-wrapper">
    <div class="admin-login-left">
      <div class="admin-login-overlay"></div>
      <!-- Animated particles -->
      <div class="admin-login-particles">
        <div class="admin-login-particle"></div>
        <div class="admin-login-particle"></div>
        <div class="admin-login-particle"></div>
        <div class="admin-login-particle"></div>
        <div class="admin-login-particle"></div>
      </div>
      <div class="admin-login-content">
        <div class="admin-login-logo">
          <img src="/static/images/logo-white.png" alt="Library Management System" class="img-fluid">
        </div>
        <h1>Library Management System</h1>
        <p class="lead">Manage your libraries with our powerful administration system</p>
        <div class="admin-login-features">
          <div class="feature-item">
            <i class="fas fa-building"></i>
            <span>Multiple Libraries</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-book"></i>
            <span>Book Management</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-users"></i>
            <span>User Management</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-chart-bar"></i>
            <span>Advanced Reports</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-exchange-alt"></i>
            <span>Transaction Tracking</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-shield-alt"></i>
            <span>Role-Based Access</span>
          </div>
        </div>
      </div>
    </div>
    <div class="admin-login-right">
      <div class="admin-login-form-container">
        <div class="admin-login-header">
          <h2>{% trans "Admin Login" %}</h2>
          <p>Please enter your credentials to access the admin panel</p>
          <div class="login-role-selector mb-4">
            <div class="btn-group w-100" role="group">
              <input type="radio" class="btn-check" name="login-role" id="super-admin" autocomplete="off" checked>
              <label class="btn btn-outline-secondary" for="super-admin">
                <i class="fas fa-user-shield me-1"></i> Super Admin
              </label>

              <input type="radio" class="btn-check" name="login-role" id="library-admin" autocomplete="off">
              <label class="btn btn-outline-secondary" for="library-admin">
                <i class="fas fa-user-tie me-1"></i> Library Admin
              </label>

              <input type="radio" class="btn-check" name="login-role" id="staff" autocomplete="off">
              <label class="btn btn-outline-secondary" for="staff">
                <i class="fas fa-user me-1"></i> Staff
              </label>
            </div>
          </div>
        </div>

        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <form class="admin-login-form" method="POST" action="{% url 'account_login' %}">
          {% csrf_token %}

          <div class="form-floating mb-3">
            <input type="email" name="login" class="form-control" id="id_login" placeholder="name@example.com" required>
            <label for="id_login">Email address</label>
            <div class="form-icon">
              <i class="fas fa-envelope"></i>
            </div>
          </div>

          <div class="form-floating mb-3">
            <input type="password" name="password" class="form-control" id="id_password" placeholder="Password" required>
            <label for="id_password">Password</label>
            <div class="password-toggle">
              <i class="fas fa-eye" id="togglePassword"></i>
            </div>
            <div class="form-icon">
              <i class="fas fa-lock"></i>
            </div>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" name="remember" id="id_remember">
            <label class="form-check-label" for="id_remember">
              Remember me
            </label>
          </div>

          {% if redirect_field_value %}
          <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
          {% endif %}

          <div class="d-grid gap-2">
            <button class="btn btn-primary btn-lg" type="submit">
              <i class="fas fa-sign-in-alt me-2"></i>{% trans "Sign In" %}
            </button>
          </div>

          <div class="admin-login-links mt-3">
            <a href="{% url 'account_reset_password' %}">{% trans "Forgot Password?" %}</a>
            <span class="separator">|</span>
            <a href="{% url 'core:home' %}">{% trans "Back to Main Site" %}</a>
          </div>
        </form>

        <div class="admin-login-footer">
          <p>&copy; {% now "Y" %} Library Management System. All rights reserved.</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Password toggle functionality
    const togglePassword = document.querySelector('#togglePassword');
    const password = document.querySelector('#id_password');

    if (togglePassword && password) {
      togglePassword.addEventListener('click', function() {
        // Toggle the type attribute
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);

        // Toggle the icon
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');
      });
    }

    // Role selector functionality
    const roleSelectors = document.querySelectorAll('input[name="login-role"]');
    const emailInput = document.querySelector('#id_login');

    // Sample emails for demonstration
    const roleEmails = {
      'super-admin': 'superadmin@library.com',
      'library-admin': 'libraryadmin@library.com',
      'staff': 'staff@library.com'
    };

    roleSelectors.forEach(selector => {
      selector.addEventListener('change', function() {
        if (this.checked) {
          emailInput.value = roleEmails[this.id];
          // Add a subtle animation to highlight the change
          emailInput.classList.add('highlight-input');
          setTimeout(() => {
            emailInput.classList.remove('highlight-input');
          }, 1000);
        }
      });
    });

    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', function() {
        // Find the theme selector toggle button and click it
        const themeButton = document.querySelector('.theme-selector-toggle');
        if (themeButton) {
          themeButton.click();
        }
      });
    }

    // 3D effect on mouse move
    const wrapper = document.querySelector('.admin-login-wrapper');
    const content = document.querySelector('.admin-login-content');

    if (wrapper && content) {
      wrapper.addEventListener('mousemove', function(e) {
        const xAxis = (window.innerWidth / 2 - e.pageX) / 25;
        const yAxis = (window.innerHeight / 2 - e.pageY) / 25;
        wrapper.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg) translateY(-5px)`;
      });

      // Reset on mouse leave
      wrapper.addEventListener('mouseleave', function() {
        wrapper.style.transform = 'rotateY(0deg) rotateX(0deg) translateY(-5px)';
      });

      // Reset on mouse enter
      wrapper.addEventListener('mouseenter', function() {
        wrapper.style.transition = 'none';
      });
    }
  });
</script>
{% endblock %}
