{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Library Management System{% endblock %}

{% block content %}
<!-- Ultra-Modern Hero Section with 3D Elements and Advanced Animations -->
<div class="hero-section position-relative overflow-hidden">
    <div class="hero-video-bg">
        <div class="hero-video-overlay"></div>
        <video autoplay muted loop playsinline class="hero-video">
            <source src="{% static 'videos/library-ambient.mp4' %}" type="video/mp4" onerror="this.parentElement.style.display='none'">
        </video>
    </div>
    <div class="hero-pattern-modern"></div>
    <div class="hero-particles" id="hero-particles"></div>
    <div class="container position-relative z-index-1">
        <div class="row align-items-center min-vh-75">
            <div class="col-lg-6" data-aos="fade-up" data-aos-duration="1000">
                <div class="hero-content-wrapper">
                    <div class="hero-badge animate__animated animate__fadeInDown animate__delay-1s">
                        <span class="badge-pill">
                            <i class="fas fa-crown me-1"></i> World-Class Library Network
                        </span>
                    </div>
                    <h1 class="hero-title animate__animated animate__fadeIn">
                        <span class="hero-title-line d-block">Unlock a</span>
                        <span class="hero-title-line d-block"><span class="text-gradient-primary">Transformative</span> Reading</span>
                        <span class="hero-title-line d-block">Journey</span>
                    </h1>
                    <div class="hero-typed-wrapper animate__animated animate__fadeIn animate__delay-1s">
                        <span class="typed-text"></span>
                    </div>
                    <p class="hero-description animate__animated animate__fadeIn animate__delay-1s">
                        Discover our curated collection of over 10 million books across our global network of state-of-the-art libraries. Experience knowledge, entertainment, and community in one revolutionary platform.
                    </p>
                    <div class="hero-buttons animate__animated animate__fadeIn animate__delay-2s">
                        <a href="{% url 'books:book_list' %}" class="btn btn-3d-primary btn-lg me-md-3 hover-float">
                            <i class="fas fa-book-open me-2"></i>Discover Collection
                        </a>
                        <a href="{% url 'libraries:library_list' %}" class="btn btn-glass-light btn-lg hover-float">
                            <i class="fas fa-map-marker-alt me-2"></i>Find Nearby Libraries
                        </a>
                    </div>
                    <div class="hero-features animate__animated animate__fadeIn animate__delay-3s">
                        <div class="hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>10+ Million Books</span>
                        </div>
                        <div class="hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>500+ Premium Locations</span>
                        </div>
                        <div class="hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>AI-Powered Recommendations</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200" data-aos-duration="1000">
                <div class="hero-image-container">
                    <div class="hero-image-3d-wrapper">
                        <div class="hero-image-decoration-3d"></div>
                        <div class="hero-image-glow"></div>
                        <img src="{% static 'images/library-hero.jpg' %}" alt="Modern Library"
                             class="hero-image-3d img-fluid rounded-xl shadow-2xl animate__animated animate__zoomIn"
                             onerror="this.src='https://placehold.co/600x400?text=Premium+Library'">
                        <div class="hero-image-floating-elements">
                            <div class="floating-element book-element" style="animation-delay: 0.2s">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="floating-element user-element" style="animation-delay: 0.5s">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="floating-element search-element" style="animation-delay: 0.8s">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="floating-element digital-element" style="animation-delay: 1.1s">
                                <i class="fas fa-tablet-alt"></i>
                            </div>
                        </div>
                        <div class="hero-image-badge animate__animated animate__fadeInRight animate__delay-2s">
                            <div class="badge-content">
                                <div class="badge-icon">
                                    <i class="fas fa-gem"></i>
                                </div>
                                <div class="badge-text">
                                    <span class="badge-title">Elite</span>
                                    <span class="badge-subtitle">Experience</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="hero-shapes-modern">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
        <div class="shape shape-5"></div>
        <div class="shape shape-6"></div>
    </div>
    <div class="hero-scroll-indicator animate__animated animate__fadeInUp animate__delay-3s">
        <div class="scroll-text">Explore More</div>
        <div class="scroll-icon">
            <i class="fas fa-chevron-down"></i>
        </div>
    </div>
</div>

<!-- Ultra-Modern Stats Section with Advanced Visual Elements -->
<div class="stats-section py-6 position-relative">
    <div class="section-pattern-dots-3d"></div>
    <div class="section-gradient-overlay"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Remarkable Growth</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Redefining Library Excellence</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Our revolutionary platform is transforming how people access knowledge worldwide with unprecedented scale and innovation</p>
        </div>
        <div class="row">
            <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="100">
                <div class="stat-card-premium hover-lift-lg">
                    <div class="stat-card-background"></div>
                    <div class="stat-card-glow"></div>
                    <div class="stat-card-content">
                        <div class="stat-card-icon-container">
                            <div class="stat-card-icon-bg"></div>
                            <div class="stat-card-icon">
                                <i class="fas fa-building"></i>
                            </div>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-value-container">
                                <div class="stat-card-value counter">{{ total_libraries }}</div>
                                <div class="stat-card-plus">+</div>
                            </div>
                            <p class="stat-card-label">Elite Libraries</p>
                            <div class="stat-card-progress">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="stat-card-trend up">
                                    <i class="fas fa-arrow-up"></i> 15% growth this quarter
                                </div>
                            </div>
                            <div class="stat-card-badge">
                                <span>Global Network</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="200">
                <div class="stat-card-premium hover-lift-lg">
                    <div class="stat-card-background"></div>
                    <div class="stat-card-glow"></div>
                    <div class="stat-card-content">
                        <div class="stat-card-icon-container">
                            <div class="stat-card-icon-bg"></div>
                            <div class="stat-card-icon">
                                <i class="fas fa-book"></i>
                            </div>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-value-container">
                                <div class="stat-card-value counter">{{ total_books }}</div>
                                <div class="stat-card-plus">+</div>
                            </div>
                            <p class="stat-card-label">Curated Titles</p>
                            <div class="stat-card-progress">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="stat-card-trend up">
                                    <i class="fas fa-arrow-up"></i> 28% growth this quarter
                                </div>
                            </div>
                            <div class="stat-card-badge">
                                <span>Expanding Collection</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="300">
                <div class="stat-card-premium hover-lift-lg">
                    <div class="stat-card-background"></div>
                    <div class="stat-card-glow"></div>
                    <div class="stat-card-content">
                        <div class="stat-card-icon-container">
                            <div class="stat-card-icon-bg"></div>
                            <div class="stat-card-icon">
                                <i class="fas fa-copy"></i>
                            </div>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-value-container">
                                <div class="stat-card-value counter">{{ total_book_copies }}</div>
                                <div class="stat-card-plus">+</div>
                            </div>
                            <p class="stat-card-label">Available Copies</p>
                            <div class="stat-card-progress">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="stat-card-trend up">
                                    <i class="fas fa-arrow-up"></i> 22% growth this quarter
                                </div>
                            </div>
                            <div class="stat-card-badge">
                                <span>Instant Access</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-12 text-center" data-aos="fade-up" data-aos-delay="400">
                <div class="stats-highlight-box">
                    <div class="stats-highlight-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h4 class="stats-highlight-title">Unprecedented Growth</h4>
                    <p class="stats-highlight-description">
                        Our platform has experienced a remarkable <span class="text-gradient-primary">250% increase</span> in user engagement over the past year, with members spending an average of <span class="text-gradient-primary">45 minutes</span> per session exploring our vast collection.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Premium Books Showcase with 3D Carousel and Category Filters -->
<div class="books-showcase-section py-6 position-relative">
    <div class="section-pattern-dots-3d"></div>
    <div class="section-wave-pattern"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Exceptional Collection</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Discover Literary Treasures</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Explore our meticulously curated selection of extraordinary books that inspire, educate, and transform</p>
        </div>

        <!-- Featured Book Spotlight -->
        <div class="featured-book-spotlight mb-5" data-aos="fade-up" data-aos-delay="100">
            <div class="row align-items-center">
                <div class="col-lg-5 mb-4 mb-lg-0">
                    <div class="featured-book-image-container">
                        <div class="featured-book-badge">
                            <span><i class="fas fa-crown me-1"></i> Featured</span>
                        </div>
                        <div class="featured-book-3d">
                            <img src="{% static 'images/featured-book.jpg' %}" alt="Featured Book" class="img-fluid rounded-lg shadow-lg" onerror="this.src='https://placehold.co/400x600?text=Featured+Book'">
                            <div class="featured-book-glow"></div>
                            <div class="featured-book-reflection"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="featured-book-content">
                        <div class="featured-book-header">
                            <div class="featured-book-category">
                                <span class="badge-premium">Bestseller</span>
                                <span class="badge-premium">Fiction</span>
                            </div>
                            <h3 class="featured-book-title">The Luminous Odyssey</h3>
                            <div class="featured-book-author">
                                <img src="{% static 'images/author-avatar.jpg' %}" alt="Author" class="author-avatar" onerror="this.src='https://placehold.co/50x50?text=Author'">
                                <span>By <strong>Alexandra Rivers</strong></span>
                            </div>
                        </div>
                        <div class="featured-book-rating">
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <span class="rating-value">4.8</span>
                            <span class="rating-count">(342 reviews)</span>
                        </div>
                        <p class="featured-book-description">
                            A captivating journey through time and consciousness, "The Luminous Odyssey" follows protagonist Elara as she discovers hidden dimensions within our reality. This groundbreaking novel blends philosophical depth with breathtaking adventure, earning it the prestigious International Literary Award.
                        </p>
                        <div class="featured-book-meta">
                            <div class="meta-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Published: May 2023</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-book-open"></i>
                                <span>Pages: 432</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-language"></i>
                                <span>Language: English</span>
                            </div>
                        </div>
                        <div class="featured-book-actions">
                            <a href="#" class="btn btn-3d-primary hover-float">
                                <i class="fas fa-info-circle me-2"></i>View Details
                            </a>
                            <a href="#" class="btn btn-outline-primary hover-float">
                                <i class="fas fa-bookmark me-2"></i>Reserve Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="books-filter-tabs" data-aos="fade-up" data-aos-delay="200">
            <ul class="nav nav-pills justify-content-center mb-4" id="booksTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="all-books-tab" data-bs-toggle="pill" data-bs-target="#all-books" type="button" role="tab" aria-controls="all-books" aria-selected="true">
                        <i class="fas fa-th me-2"></i>All Categories
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="fiction-tab" data-bs-toggle="pill" data-bs-target="#fiction" type="button" role="tab" aria-controls="fiction" aria-selected="false">
                        <i class="fas fa-book me-2"></i>Fiction
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="non-fiction-tab" data-bs-toggle="pill" data-bs-target="#non-fiction" type="button" role="tab" aria-controls="non-fiction" aria-selected="false">
                        <i class="fas fa-graduation-cap me-2"></i>Non-Fiction
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="science-tab" data-bs-toggle="pill" data-bs-target="#science" type="button" role="tab" aria-controls="science" aria-selected="false">
                        <i class="fas fa-atom me-2"></i>Science
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="history-tab" data-bs-toggle="pill" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">
                        <i class="fas fa-landmark me-2"></i>History
                    </button>
                </li>
            </ul>
        </div>

        <div class="tab-content" id="booksTabContent">
            <div class="tab-pane fade show active" id="all-books" role="tabpanel" aria-labelledby="all-books-tab">
                <div class="book-carousel-3d swiper-container" data-aos="fade-up">
                    <div class="swiper-wrapper">
                        {% for book in latest_books %}
                        <div class="swiper-slide">
                            <div class="book-card-premium">
                                <div class="book-card-inner">
                                    <div class="book-cover-3d">
                                        {% if book.cover_image %}
                                            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
                                        {% else %}
                                            <img src="https://placehold.co/200x300?text=No+Cover" alt="No Cover">
                                        {% endif %}
                                        <div class="book-spine"></div>
                                        <div class="book-cover-shine"></div>
                                        <div class="book-cover-glow"></div>
                                    </div>
                                    <div class="book-overlay-3d">
                                        <div class="book-overlay-content">
                                            <div class="book-quick-actions">
                                                <a href="{% url 'books:book_detail' slug=book.slug %}" class="book-action-btn" data-bs-toggle="tooltip" title="View Details">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a href="#" class="book-action-btn" data-bs-toggle="tooltip" title="Add to Wishlist">
                                                    <i class="fas fa-heart"></i>
                                                </a>
                                                <a href="#" class="book-action-btn book-preview-btn" data-bs-toggle="tooltip" title="Quick Preview">
                                                    <i class="fas fa-search-plus"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="book-info-premium">
                                    <div class="book-categories">
                                        {% with category=book.categories.first %}
                                            {% if category %}
                                                <span class="badge-premium">{{ category.name }}</span>
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                    <h5 class="book-title">{{ book.title|truncatechars:25 }}</h5>
                                    <div class="book-meta">
                                        <div class="book-authors">
                                            <i class="fas fa-user-edit"></i>
                                            {% for author in book.authors.all %}
                                                {% if forloop.first %}{% endif %}
                                                {{ author.name }}{% if not forloop.last %}, {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="book-rating">
                                            <i class="fas fa-star"></i>
                                            <span>4.8</span>
                                        </div>
                                    </div>
                                    <a href="{% url 'books:book_detail' slug=book.slug %}" class="btn btn-primary btn-sm w-100 mt-2 hover-float">
                                        <i class="fas fa-info-circle me-1"></i>View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
                <div class="swiper-navigation-custom">
                    <div class="swiper-button-prev-custom">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="swiper-button-next-custom">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>

            <!-- Other tabs would have similar content but filtered by category -->
            <div class="tab-pane fade" id="fiction" role="tabpanel" aria-labelledby="fiction-tab">
                <!-- Fiction books would be displayed here -->
                <div class="category-placeholder">
                    <div class="category-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h4>Fiction Collection</h4>
                    <p>Explore our vast collection of fiction books, from classic literature to contemporary bestsellers.</p>
                    <button class="btn btn-primary">Load Fiction Books</button>
                </div>
            </div>

            <div class="tab-pane fade" id="non-fiction" role="tabpanel" aria-labelledby="non-fiction-tab">
                <!-- Non-Fiction books would be displayed here -->
                <div class="category-placeholder">
                    <div class="category-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h4>Non-Fiction Collection</h4>
                    <p>Discover insightful non-fiction works covering biography, self-improvement, science, and more.</p>
                    <button class="btn btn-primary">Load Non-Fiction Books</button>
                </div>
            </div>

            <div class="tab-pane fade" id="science" role="tabpanel" aria-labelledby="science-tab">
                <!-- Science books would be displayed here -->
                <div class="category-placeholder">
                    <div class="category-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <h4>Science Collection</h4>
                    <p>Explore fascinating scientific discoveries and theories across various disciplines.</p>
                    <button class="btn btn-primary">Load Science Books</button>
                </div>
            </div>

            <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                <!-- History books would be displayed here -->
                <div class="category-placeholder">
                    <div class="category-icon">
                        <i class="fas fa-landmark"></i>
                    </div>
                    <h4>History Collection</h4>
                    <p>Journey through time with our comprehensive collection of historical works and analyses.</p>
                    <button class="btn btn-primary">Load History Books</button>
                </div>
            </div>
        </div>

        <div class="text-center mt-5" data-aos="fade-up">
            <a href="{% url 'books:book_list' %}" class="btn btn-3d-primary btn-lg hover-float">
                Explore Complete Collection <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</div>

<!-- Interactive How It Works Section with 3D Elements -->
<div class="how-it-works-section py-6 position-relative">
    <div class="section-wave-pattern-3d"></div>
    <div class="section-gradient-radial"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Effortless Experience</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Your Journey With Us</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Discover how our revolutionary platform transforms your reading experience in four simple steps</p>
        </div>

        <div class="steps-timeline-wrapper" data-aos="fade-up" data-aos-delay="400">
            <div class="steps-timeline">
                <div class="timeline-progress-bar">
                    <div class="timeline-progress-indicator"></div>
                </div>
                <div class="timeline-nodes">
                    <div class="timeline-node active" data-step="1"></div>
                    <div class="timeline-node" data-step="2"></div>
                    <div class="timeline-node" data-step="3"></div>
                    <div class="timeline-node" data-step="4"></div>
                </div>
            </div>
        </div>

        <div class="steps-carousel-container">
            <div class="steps-carousel swiper-container" data-aos="fade-up">
                <div class="swiper-wrapper">
                    <!-- Step 1 -->
                    <div class="swiper-slide">
                        <div class="step-card-premium hover-lift-lg">
                            <div class="step-card-inner">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 mb-4 mb-lg-0">
                                        <div class="step-image-container">
                                            <div class="step-image-wrapper">
                                                <img src="{% static 'images/step1-discover.jpg' %}" alt="Discover Libraries" class="img-fluid rounded-lg" onerror="this.src='https://placehold.co/600x400?text=Discover+Libraries'">
                                                <div class="step-image-overlay"></div>
                                                <div class="step-number-badge">1</div>
                                            </div>
                                            <div class="step-image-decoration">
                                                <div class="decoration-element element-1"></div>
                                                <div class="decoration-element element-2"></div>
                                                <div class="decoration-element element-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="step-content">
                                            <div class="step-icon-container">
                                                <div class="step-icon-bg"></div>
                                                <div class="step-icon-premium">
                                                    <i class="fas fa-map-marked-alt"></i>
                                                </div>
                                            </div>
                                            <h3 class="step-title-premium">Discover Nearby Libraries</h3>
                                            <p class="step-description-premium">
                                                Use our interactive map to locate elite libraries in your area. Our advanced geolocation technology identifies the closest facilities with the resources you need.
                                            </p>
                                            <div class="step-features">
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Precise location tracking</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Virtual 3D library tours</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Real-time availability updates</span>
                                                </div>
                                            </div>
                                            <a href="{% url 'libraries:library_list' %}" class="btn btn-outline-primary mt-3 hover-float">
                                                <i class="fas fa-compass me-2"></i>Find Libraries
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="swiper-slide">
                        <div class="step-card-premium hover-lift-lg">
                            <div class="step-card-inner">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 mb-4 mb-lg-0">
                                        <div class="step-image-container">
                                            <div class="step-image-wrapper">
                                                <img src="{% static 'images/step2-join.jpg' %}" alt="Join Membership" class="img-fluid rounded-lg" onerror="this.src='https://placehold.co/600x400?text=Join+Membership'">
                                                <div class="step-image-overlay"></div>
                                                <div class="step-number-badge">2</div>
                                            </div>
                                            <div class="step-image-decoration">
                                                <div class="decoration-element element-1"></div>
                                                <div class="decoration-element element-2"></div>
                                                <div class="decoration-element element-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="step-content">
                                            <div class="step-icon-container">
                                                <div class="step-icon-bg"></div>
                                                <div class="step-icon-premium">
                                                    <i class="fas fa-user-plus"></i>
                                                </div>
                                            </div>
                                            <h3 class="step-title-premium">Join Our Elite Membership</h3>
                                            <p class="step-description-premium">
                                                Select from our tiered membership plans designed to fit your reading habits. Our seamless digital onboarding process takes less than 3 minutes to complete.
                                            </p>
                                            <div class="step-features">
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Instant digital card issuance</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Flexible membership options</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Member-exclusive events</span>
                                                </div>
                                            </div>
                                            <a href="{% url 'account_signup' %}" class="btn btn-outline-primary mt-3 hover-float">
                                                <i class="fas fa-id-card me-2"></i>Become a Member
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="swiper-slide">
                        <div class="step-card-premium hover-lift-lg">
                            <div class="step-card-inner">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 mb-4 mb-lg-0">
                                        <div class="step-image-container">
                                            <div class="step-image-wrapper">
                                                <img src="{% static 'images/step3-explore.jpg' %}" alt="Explore Collection" class="img-fluid rounded-lg" onerror="this.src='https://placehold.co/600x400?text=Explore+Collection'">
                                                <div class="step-image-overlay"></div>
                                                <div class="step-number-badge">3</div>
                                            </div>
                                            <div class="step-image-decoration">
                                                <div class="decoration-element element-1"></div>
                                                <div class="decoration-element element-2"></div>
                                                <div class="decoration-element element-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="step-content">
                                            <div class="step-icon-container">
                                                <div class="step-icon-bg"></div>
                                                <div class="step-icon-premium">
                                                    <i class="fas fa-search"></i>
                                                </div>
                                            </div>
                                            <h3 class="step-title-premium">Explore Our Vast Collection</h3>
                                            <p class="step-description-premium">
                                                Browse our extensive catalog using our advanced search and filtering system. Our AI-powered recommendation engine learns your preferences to suggest perfect matches.
                                            </p>
                                            <div class="step-features">
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Advanced search capabilities</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Personalized recommendations</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Curated reading lists</span>
                                                </div>
                                            </div>
                                            <a href="{% url 'books:book_list' %}" class="btn btn-outline-primary mt-3 hover-float">
                                                <i class="fas fa-book-open me-2"></i>Browse Collection
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="swiper-slide">
                        <div class="step-card-premium hover-lift-lg">
                            <div class="step-card-inner">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 mb-4 mb-lg-0">
                                        <div class="step-image-container">
                                            <div class="step-image-wrapper">
                                                <img src="{% static 'images/step4-enjoy.jpg' %}" alt="Enjoy Reading" class="img-fluid rounded-lg" onerror="this.src='https://placehold.co/600x400?text=Enjoy+Reading'">
                                                <div class="step-image-overlay"></div>
                                                <div class="step-number-badge">4</div>
                                            </div>
                                            <div class="step-image-decoration">
                                                <div class="decoration-element element-1"></div>
                                                <div class="decoration-element element-2"></div>
                                                <div class="decoration-element element-3"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="step-content">
                                            <div class="step-icon-container">
                                                <div class="step-icon-bg"></div>
                                                <div class="step-icon-premium">
                                                    <i class="fas fa-book-reader"></i>
                                                </div>
                                            </div>
                                            <h3 class="step-title-premium">Enjoy Your Reading Journey</h3>
                                            <p class="step-description-premium">
                                                Access your books in multiple formats - physical copies, e-books, or audiobooks. Our synchronized platform keeps track of your progress across all devices.
                                            </p>
                                            <div class="step-features">
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Multi-format availability</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Cross-device synchronization</span>
                                                </div>
                                                <div class="step-feature-item">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>Reading analytics dashboard</span>
                                                </div>
                                            </div>
                                            <a href="#" class="btn btn-outline-primary mt-3 hover-float">
                                                <i class="fas fa-glasses me-2"></i>Start Reading
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="steps-navigation">
                <div class="steps-button-prev">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="steps-pagination"></div>
                <div class="steps-button-next">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <div class="text-center mt-5" data-aos="fade-up">
            <a href="{% url 'account_signup' %}" class="btn btn-3d-primary btn-lg hover-float">
                Begin Your Journey Now <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</div>

<!-- Premium Featured Libraries Section with Interactive Map -->
<div class="featured-libraries-section py-6 position-relative">
    <div class="section-pattern-grid-3d"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Premium Network</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Featured Libraries</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Discover our top-rated premium libraries with extensive collections and state-of-the-art facilities</p>
        </div>

        <div class="libraries-view-toggle mb-4" data-aos="fade-up" data-aos-delay="400">
            <div class="btn-group" role="group" aria-label="Library View Toggle">
                <button type="button" class="btn btn-outline-primary active" id="grid-view-btn">
                    <i class="fas fa-th-large me-2"></i>Grid View
                </button>
                <button type="button" class="btn btn-outline-primary" id="map-view-btn">
                    <i class="fas fa-map-marked-alt me-2"></i>Map View
                </button>
            </div>
        </div>

        <div class="libraries-view-container">
            <div class="libraries-grid-view active">
                <div class="row">
                    {% for library in featured_libraries %}
                    <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{% if forloop.counter == 1 %}100{% elif forloop.counter == 2 %}200{% else %}300{% endif %}">
                        <div class="library-card-premium hover-lift-lg">
                            <div class="library-card-inner">
                                <div class="library-image-premium hover-zoom-in">
                                    {% if library.image %}
                                        <img src="{{ library.image.url }}" alt="{{ library.name }}">
                                    {% else %}
                                        <img src="https://placehold.co/400x200?text=Premium+Library" alt="Library">
                                    {% endif %}
                                    <div class="library-badge-premium">
                                        <span class="badge-premium">
                                            <i class="fas fa-award me-1"></i>Featured
                                        </span>
                                    </div>
                                    <div class="library-overlay-premium">
                                        <div class="library-quick-info">
                                            <div class="library-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                                <span>4.8</span>
                                            </div>
                                            <div class="library-quick-actions">
                                                <a href="#" class="library-action-btn" data-bs-toggle="tooltip" title="Virtual Tour">
                                                    <i class="fas fa-vr-cardboard"></i>
                                                </a>
                                                <a href="#" class="library-action-btn" data-bs-toggle="tooltip" title="Save to Favorites">
                                                    <i class="far fa-heart"></i>
                                                </a>
                                                <a href="#" class="library-action-btn" data-bs-toggle="tooltip" title="Share">
                                                    <i class="fas fa-share-alt"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="library-info-premium">
                                    <h4 class="library-name-premium">{{ library.name }}</h4>
                                    <div class="library-meta-premium">
                                        <div class="library-meta-item-premium">
                                            <i class="fas fa-book"></i>
                                            <span>{{ library.books.count }} Books</span>
                                        </div>
                                        <div class="library-meta-item-premium">
                                            <i class="fas fa-users"></i>
                                            <span>{{ library.members.count }} Members</span>
                                        </div>
                                    </div>
                                    <p class="library-description-premium">{{ library.description|truncatechars:100 }}</p>
                                    <div class="library-features-premium">
                                        <span class="library-feature-badge">
                                            <i class="fas fa-wifi"></i> Free WiFi
                                        </span>
                                        <span class="library-feature-badge">
                                            <i class="fas fa-coffee"></i> Café
                                        </span>
                                        <span class="library-feature-badge">
                                            <i class="fas fa-laptop"></i> Study Rooms
                                        </span>
                                    </div>
                                    <div class="library-footer-premium">
                                        <div class="library-location-premium">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>{{ library.city }}, {{ library.country }}</span>
                                        </div>
                                        <a href="{% url 'libraries:library_detail' slug=library.slug %}" class="btn btn-primary btn-sm stretched-link">
                                            Explore Library
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="libraries-map-view">
                <div class="libraries-map-container" id="librariesMap">
                    <div class="map-placeholder text-center py-5">
                        <i class="fas fa-map-marked-alt fa-5x mb-3 text-primary"></i>
                        <h4>Interactive Map</h4>
                        <p class="lead">Our interactive map would display here, showing the locations of all our premium libraries.</p>
                        <p>This feature requires integration with a mapping service like Google Maps or Mapbox.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-5" data-aos="fade-up">
            <a href="{% url 'libraries:library_list' %}" class="btn btn-outline-primary btn-lg hover-float">
                Explore All Libraries <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</div>

<!-- Premium Testimonials Section with Advanced Design -->
<div class="testimonials-section py-6 position-relative">
    <div class="section-pattern-circles-3d"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Success Stories</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">What Our Users Say</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Discover how our premium library management system is transforming experiences for users worldwide</p>
        </div>

        <div class="testimonials-tabs" data-aos="fade-up" data-aos-delay="400">
            <ul class="nav nav-pills justify-content-center mb-4" id="testimonialsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="all-testimonials-tab" data-bs-toggle="pill" data-bs-target="#all-testimonials" type="button" role="tab" aria-controls="all-testimonials" aria-selected="true">All</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="librarians-tab" data-bs-toggle="pill" data-bs-target="#librarians" type="button" role="tab" aria-controls="librarians" aria-selected="false">Librarians</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="members-tab" data-bs-toggle="pill" data-bs-target="#members" type="button" role="tab" aria-controls="members" aria-selected="false">Members</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="administrators-tab" data-bs-toggle="pill" data-bs-target="#administrators" type="button" role="tab" aria-controls="administrators" aria-selected="false">Administrators</button>
                </li>
            </ul>
        </div>

        <div class="tab-content" id="testimonialsTabContent">
            <div class="tab-pane fade show active" id="all-testimonials" role="tabpanel" aria-labelledby="all-testimonials-tab">
                <div class="testimonials-carousel-premium swiper-container" data-aos="fade-up">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="testimonial-card-premium hover-lift-lg">
                                <div class="testimonial-card-inner">
                                    <div class="testimonial-quote-icon">
                                        <i class="fas fa-quote-left"></i>
                                    </div>
                                    <div class="testimonial-content-premium">
                                        <p>"The premium library management system has completely transformed how we handle our collections. It's incredibly intuitive, efficient, and has significantly improved our workflow. The user interface is clean and modern, making it a joy to use every day. The analytics dashboard provides valuable insights that help us make better decisions for our patrons."</p>
                                    </div>
                                    <div class="testimonial-rating-premium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <span>5.0</span>
                                    </div>
                                    <div class="testimonial-author-premium">
                                        <div class="author-image">
                                            <img src="{% static 'images/testimonials/user1.jpg' %}" alt="Sarah Johnson" onerror="this.src='https://placehold.co/100x100?text=SJ'">
                                        </div>
                                        <div class="author-info-premium">
                                            <h5 class="author-name">Sarah Johnson</h5>
                                            <p class="author-title">Head Librarian</p>
                                            <p class="author-location">Boston Public Library</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="swiper-slide">
                            <div class="testimonial-card-premium hover-lift-lg">
                                <div class="testimonial-card-inner">
                                    <div class="testimonial-quote-icon">
                                        <i class="fas fa-quote-left"></i>
                                    </div>
                                    <div class="testimonial-content-premium">
                                        <p>"As a frequent library visitor, this system has made finding and borrowing books so much easier. I love the personalized AI-powered recommendations and the ability to track my reading history. The mobile app is a game-changer! I can search for books, place holds, and even access digital content right from my phone. The virtual bookshelf feature helps me organize my reading list efficiently."</p>
                                    </div>
                                    <div class="testimonial-rating-premium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span>4.8</span>
                                    </div>
                                    <div class="testimonial-author-premium">
                                        <div class="author-image">
                                            <img src="{% static 'images/testimonials/user2.jpg' %}" alt="Michael Chen" onerror="this.src='https://placehold.co/100x100?text=MC'">
                                        </div>
                                        <div class="author-info-premium">
                                            <h5 class="author-name">Michael Chen</h5>
                                            <p class="author-title">Premium Member</p>
                                            <p class="author-location">San Francisco, CA</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="swiper-slide">
                            <div class="testimonial-card-premium hover-lift-lg">
                                <div class="testimonial-card-inner">
                                    <div class="testimonial-quote-icon">
                                        <i class="fas fa-quote-left"></i>
                                    </div>
                                    <div class="testimonial-content-premium">
                                        <p>"Managing multiple libraries has never been easier. The analytics and reporting features provide valuable insights that help us make data-driven decisions. The support team is incredibly responsive and helpful. We've seen a 30% increase in member engagement since implementing this system. The centralized dashboard gives me a complete overview of all our branches at a glance."</p>
                                    </div>
                                    <div class="testimonial-rating-premium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <span>5.0</span>
                                    </div>
                                    <div class="testimonial-author-premium">
                                        <div class="author-image">
                                            <img src="{% static 'images/testimonials/user3.jpg' %}" alt="Emily Rodriguez" onerror="this.src='https://placehold.co/100x100?text=ER'">
                                        </div>
                                        <div class="author-info-premium">
                                            <h5 class="author-name">Emily Rodriguez</h5>
                                            <p class="author-title">District Library Director</p>
                                            <p class="author-location">Chicago Public Library Network</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="swiper-slide">
                            <div class="testimonial-card-premium hover-lift-lg">
                                <div class="testimonial-card-inner">
                                    <div class="testimonial-quote-icon">
                                        <i class="fas fa-quote-left"></i>
                                    </div>
                                    <div class="testimonial-content-premium">
                                        <p>"The integration capabilities of this system are outstanding. We've connected it with our university's student information system, making it seamless for students to access resources. The API documentation is comprehensive, and the development team was incredibly helpful during implementation. This has revolutionized how our academic library operates."</p>
                                    </div>
                                    <div class="testimonial-rating-premium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <span>5.0</span>
                                    </div>
                                    <div class="testimonial-author-premium">
                                        <div class="author-image">
                                            <img src="{% static 'images/testimonials/user4.jpg' %}" alt="David Wilson" onerror="this.src='https://placehold.co/100x100?text=DW'">
                                        </div>
                                        <div class="author-info-premium">
                                            <h5 class="author-name">David Wilson</h5>
                                            <p class="author-title">IT Director</p>
                                            <p class="author-location">Stanford University Library</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
                <div class="testimonial-navigation-premium">
                    <div class="swiper-button-prev-premium">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="swiper-button-next-premium">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>

            <!-- Other tabs would have filtered testimonials -->
            <div class="tab-pane fade" id="librarians" role="tabpanel" aria-labelledby="librarians-tab">
                <!-- Librarian testimonials would be displayed here -->
                <div class="text-center py-5">
                    <p class="lead">Filter by Librarians to see relevant testimonials</p>
                </div>
            </div>

            <div class="tab-pane fade" id="members" role="tabpanel" aria-labelledby="members-tab">
                <!-- Member testimonials would be displayed here -->
                <div class="text-center py-5">
                    <p class="lead">Filter by Members to see relevant testimonials</p>
                </div>
            </div>

            <div class="tab-pane fade" id="administrators" role="tabpanel" aria-labelledby="administrators-tab">
                <!-- Administrator testimonials would be displayed here -->
                <div class="text-center py-5">
                    <p class="lead">Filter by Administrators to see relevant testimonials</p>
                </div>
            </div>
        </div>

        <div class="testimonial-cta text-center mt-5" data-aos="fade-up">
            <h4 class="mb-3">Ready to experience our premium library system?</h4>
            <a href="{% url 'account_signup' %}" class="btn btn-3d-primary btn-lg hover-float">
                Join Today <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</div>

<!-- Premium Newsletter Section with 3D Elements -->
<div class="newsletter-section py-6 position-relative">
    <div class="newsletter-bg-pattern-3d"></div>
    <div class="container">
        <div class="newsletter-wrapper-premium" data-aos="fade-up">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="newsletter-content-premium">
                        <div class="section-header text-lg-start text-center mb-4">
                            <h6 class="section-subtitle">Premium Updates</h6>
                            <h2 class="section-title">Stay Connected</h2>
                            <div class="section-divider mx-lg-0 mx-auto"></div>
                            <p class="section-description">Join our exclusive newsletter for premium updates, curated book recommendations, and VIP event invitations.</p>
                        </div>

                        <div class="newsletter-benefits">
                            <div class="newsletter-benefit-item">
                                <div class="benefit-icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <div class="benefit-content">
                                    <h5>Curated Recommendations</h5>
                                    <p>Receive personalized book recommendations based on your reading preferences and history.</p>
                                </div>
                            </div>
                            <div class="newsletter-benefit-item">
                                <div class="benefit-icon">
                                    <i class="fas fa-ticket-alt"></i>
                                </div>
                                <div class="benefit-content">
                                    <h5>VIP Event Access</h5>
                                    <p>Get exclusive invitations to author meet-and-greets, book launches, and special library events.</p>
                                </div>
                            </div>
                            <div class="newsletter-benefit-item">
                                <div class="benefit-icon">
                                    <i class="fas fa-percent"></i>
                                </div>
                                <div class="benefit-content">
                                    <h5>Premium Discounts</h5>
                                    <p>Enjoy special offers, discounts on premium memberships, and early access to new features.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="newsletter-form-container-premium">
                        <div class="newsletter-form-header">
                            <div class="newsletter-form-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <h4>Subscribe Now</h4>
                            <p>Join thousands of satisfied members receiving our updates</p>
                        </div>
                        <form class="newsletter-form-premium" id="newsletterFormPremium">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="nameInput" placeholder="Your Name" required>
                                <label for="nameInput">Your Name</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="email" class="form-control" id="emailInput" placeholder="Your Email" required>
                                <label for="emailInput">Your Email</label>
                            </div>
                            <div class="form-floating mb-3">
                                <select class="form-select" id="interestSelect" required>
                                    <option value="" selected disabled>Select your interests</option>
                                    <option value="fiction">Fiction</option>
                                    <option value="non-fiction">Non-Fiction</option>
                                    <option value="science">Science & Technology</option>
                                    <option value="history">History & Biography</option>
                                    <option value="all">All Categories</option>
                                </select>
                                <label for="interestSelect">Your Interests</label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="privacyCheck" required>
                                <label class="form-check-label" for="privacyCheck">
                                    I agree to the <a href="#">Privacy Policy</a> and <a href="#">Terms of Service</a>
                                </label>
                            </div>
                            <button class="btn btn-3d-primary w-100" type="submit">
                                Subscribe Now <i class="fas fa-paper-plane ms-2"></i>
                            </button>
                        </form>
                        <div class="newsletter-form-footer">
                            <div class="subscribers-count">
                                <i class="fas fa-users"></i>
                                <span>Join 10,000+ subscribers</span>
                            </div>
                            <div class="newsletter-security">
                                <i class="fas fa-shield-alt"></i>
                                <span>Your data is secure with us</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile App Download Section -->
<div class="app-download-section py-6 position-relative">
    <div class="section-pattern-dots-3d"></div>
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 order-lg-2" data-aos="fade-left">
                <div class="app-mockup-container">
                    <div class="app-mockup-phone">
                        <div class="phone-frame">
                            <div class="phone-screen">
                                <img src="{% static 'images/app-mockup.jpg' %}" alt="Library App" onerror="this.src='https://placehold.co/300x600?text=Library+App'">
                            </div>
                            <div class="phone-notch"></div>
                        </div>
                        <div class="phone-reflection"></div>
                    </div>
                    <div class="app-features-floating">
                        <div class="app-feature-badge feature-1" style="animation-delay: 0.2s">
                            <i class="fas fa-search"></i>
                            <span>Quick Search</span>
                        </div>
                        <div class="app-feature-badge feature-2" style="animation-delay: 0.4s">
                            <i class="fas fa-barcode"></i>
                            <span>Scan Books</span>
                        </div>
                        <div class="app-feature-badge feature-3" style="animation-delay: 0.6s">
                            <i class="fas fa-book-reader"></i>
                            <span>Digital Reading</span>
                        </div>
                        <div class="app-feature-badge feature-4" style="animation-delay: 0.8s">
                            <i class="fas fa-bell"></i>
                            <span>Due Reminders</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 order-lg-1" data-aos="fade-right">
                <div class="app-content">
                    <div class="section-header text-lg-start text-center mb-4">
                        <h6 class="section-subtitle">Mobile Experience</h6>
                        <h2 class="section-title">Library in Your Pocket</h2>
                        <div class="section-divider mx-lg-0 mx-auto"></div>
                        <p class="section-description">Access our premium library services anytime, anywhere with our feature-rich mobile application.</p>
                    </div>

                    <div class="app-features">
                        <div class="app-feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="feature-content">
                                <h5>Advanced Search</h5>
                                <p>Find books instantly with our powerful search engine. Filter by genre, author, rating, and availability.</p>
                            </div>
                        </div>
                        <div class="app-feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-barcode"></i>
                            </div>
                            <div class="feature-content">
                                <h5>Barcode Scanner</h5>
                                <p>Scan book barcodes to instantly check availability, place holds, or add to your reading list.</p>
                            </div>
                        </div>
                        <div class="app-feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-book-reader"></i>
                            </div>
                            <div class="feature-content">
                                <h5>Digital Reading</h5>
                                <p>Access our extensive collection of e-books and audiobooks directly through the app.</p>
                            </div>
                        </div>
                        <div class="app-feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="feature-content">
                                <h5>Smart Notifications</h5>
                                <p>Receive timely reminders for due dates, available holds, and upcoming events.</p>
                            </div>
                        </div>
                    </div>

                    <div class="app-download-buttons">
                        <a href="#" class="app-download-btn">
                            <i class="fab fa-apple"></i>
                            <div class="btn-text">
                                <span class="small-text">Download on the</span>
                                <span class="large-text">App Store</span>
                            </div>
                        </a>
                        <a href="#" class="app-download-btn">
                            <i class="fab fa-google-play"></i>
                            <div class="btn-text">
                                <span class="small-text">GET IT ON</span>
                                <span class="large-text">Google Play</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Partners Section -->
<div class="partners-section py-6 position-relative">
    <div class="section-pattern-grid-3d"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Trusted Partners</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Our Collaborators</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">We work with leading organizations to provide the best library experience</p>
        </div>

        <div class="partners-carousel swiper-container" data-aos="fade-up">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner1.png' %}" alt="Partner 1" onerror="this.src='https://placehold.co/200x100?text=Partner+1'">
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner2.png' %}" alt="Partner 2" onerror="this.src='https://placehold.co/200x100?text=Partner+2'">
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner3.png' %}" alt="Partner 3" onerror="this.src='https://placehold.co/200x100?text=Partner+3'">
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner4.png' %}" alt="Partner 4" onerror="this.src='https://placehold.co/200x100?text=Partner+4'">
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner5.png' %}" alt="Partner 5" onerror="this.src='https://placehold.co/200x100?text=Partner+5'">
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="partner-item">
                        <img src="{% static 'images/partners/partner6.png' %}" alt="Partner 6" onerror="this.src='https://placehold.co/200x100?text=Partner+6'">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Call-to-Action Banner -->
<div class="cta-banner position-relative overflow-hidden">
    <div class="cta-banner-bg"></div>
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 text-lg-start text-center">
                <h3 class="cta-title" data-aos="fade-right">Ready to Elevate Your Reading Experience?</h3>
                <p class="cta-description" data-aos="fade-right" data-aos-delay="100">Join thousands of satisfied members enjoying premium library services today.</p>
            </div>
            <div class="col-lg-4 text-lg-end text-center mt-4 mt-lg-0">
                <a href="{% url 'account_signup' %}" class="btn btn-3d-light btn-lg hover-float" data-aos="fade-left">
                    <i class="fas fa-user-plus me-2"></i>Join Now
                </a>
            </div>
        </div>
    </div>
</div>

<!-- FAQ Section with Accordion -->
<div class="faq-section py-6 position-relative">
    <div class="section-pattern-dots-3d"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Common Questions</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Frequently Asked Questions</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Find answers to the most common questions about our premium library system</p>
        </div>

        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="accordion faq-accordion" id="faqAccordion" data-aos="fade-up">
                    <div class="accordion-item faq-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                <div class="faq-question-icon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <span class="faq-question-text">How do I become a member of the library?</span>
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Becoming a member is simple! You can sign up online through our website or visit any of our library locations in person. We offer different membership tiers to suit your needs, including standard, premium, and family plans. Each membership provides access to our extensive collection of books, digital resources, and exclusive events. The registration process takes just a few minutes, and you'll receive your digital membership card instantly.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item faq-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                <div class="faq-question-icon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <span class="faq-question-text">What is the loan period for borrowed books?</span>
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Our standard loan period is 21 days for physical books and 14 days for digital content. Premium members enjoy extended loan periods of 30 days. You can renew items up to three times if no one else has placed a hold on them. Renewals can be done through your online account, our mobile app, or by visiting any library location. Late returns may incur fees, but we send courtesy reminders via email or push notifications before due dates.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item faq-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                <div class="faq-question-icon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <span class="faq-question-text">Can I access digital books and resources remotely?</span>
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Yes! All members have full remote access to our digital collection, which includes e-books, audiobooks, academic journals, and research databases. You can access these resources through our website or mobile app using your membership credentials. Our digital platform is available 24/7, allowing you to read, research, and learn from anywhere in the world. We also offer offline access for downloaded content, perfect for when you're traveling or have limited internet connectivity.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item faq-item">
                        <h2 class="accordion-header" id="headingFour">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                <div class="faq-question-icon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <span class="faq-question-text">How does the book recommendation system work?</span>
                            </button>
                        </h2>
                        <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Our AI-powered recommendation system analyzes your reading history, preferences, and ratings to suggest books you might enjoy. The more you use our system, the more personalized your recommendations become. You can also set specific preferences in your profile, such as favorite genres, authors, or topics. Additionally, our librarians curate monthly recommendation lists based on trending topics and new releases. Premium members receive custom reading plans tailored to their specific interests and reading goals.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item faq-item">
                        <h2 class="accordion-header" id="headingFive">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                <div class="faq-question-icon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <span class="faq-question-text">What special events do you host for members?</span>
                            </button>
                        </h2>
                        <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>We host a variety of events throughout the year, including author meet-and-greets, book clubs, workshops, and educational seminars. Premium members get priority access to limited-capacity events and exclusive invitations to special gatherings like pre-release book launches and VIP author dinners. Our children's program features storytelling sessions, creative workshops, and educational activities. You can view the full calendar of events on our website or mobile app, and set up notifications for events that interest you.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Blog/News Section -->
<div class="blog-section py-6 position-relative">
    <div class="section-pattern-grid-3d"></div>
    <div class="container">
        <div class="section-header text-center mb-5">
            <h6 class="section-subtitle" data-aos="fade-up">Latest Updates</h6>
            <h2 class="section-title" data-aos="fade-up" data-aos-delay="100">Library News & Articles</h2>
            <div class="section-divider" data-aos="fade-up" data-aos-delay="200"></div>
            <p class="section-description" data-aos="fade-up" data-aos-delay="300">Stay informed with the latest news, events, and articles from our library network</p>
        </div>

        <div class="row">
            <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="100">
                <div class="blog-card-premium hover-lift-lg">
                    <div class="blog-card-image">
                        <img src="https://placehold.co/600x400?text=New+Book+Collection" alt="New Book Collection">
                        <div class="blog-card-date">
                            <span class="day">15</span>
                            <span class="month">Apr</span>
                        </div>
                    </div>
                    <div class="blog-card-content">
                        <div class="blog-card-category">
                            <span class="badge-premium">News</span>
                        </div>
                        <h4 class="blog-card-title">Exciting New Book Collection Arrives</h4>
                        <p class="blog-card-excerpt">Our library has just received an exciting new collection of over 5,000 books spanning various genres and topics. This expansion significantly enhances our offerings in science fiction, biography, and children's literature.</p>
                        <div class="blog-card-footer">
                            <div class="blog-card-author">
                                <img src="{% static 'images/testimonials/user1.jpg' %}" alt="Author" onerror="this.src='https://placehold.co/50x50?text=JD'">
                                <span>Jane Doe</span>
                            </div>
                            <a href="#" class="blog-card-link">Read More <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="200">
                <div class="blog-card-premium hover-lift-lg">
                    <div class="blog-card-image">
                        <img src="https://placehold.co/600x400?text=Author+Event" alt="Author Event">
                        <div class="blog-card-date">
                            <span class="day">22</span>
                            <span class="month">Apr</span>
                        </div>
                    </div>
                    <div class="blog-card-content">
                        <div class="blog-card-category">
                            <span class="badge-premium">Events</span>
                        </div>
                        <h4 class="blog-card-title">Bestselling Author to Visit Next Month</h4>
                        <p class="blog-card-excerpt">We're thrilled to announce that bestselling author Michael Johnson will be visiting our main library for a book signing and Q&A session. This exclusive event is open to all premium members.</p>
                        <div class="blog-card-footer">
                            <div class="blog-card-author">
                                <img src="{% static 'images/testimonials/user2.jpg' %}" alt="Author" onerror="this.src='https://placehold.co/50x50?text=JS'">
                                <span>John Smith</span>
                            </div>
                            <a href="#" class="blog-card-link">Read More <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="300">
                <div class="blog-card-premium hover-lift-lg">
                    <div class="blog-card-image">
                        <img src="https://placehold.co/600x400?text=Digital+Resources" alt="Digital Resources">
                        <div class="blog-card-date">
                            <span class="day">30</span>
                            <span class="month">Apr</span>
                        </div>
                    </div>
                    <div class="blog-card-content">
                        <div class="blog-card-category">
                            <span class="badge-premium">Resources</span>
                        </div>
                        <h4 class="blog-card-title">Expanded Digital Resource Access</h4>
                        <p class="blog-card-excerpt">We've partnered with leading academic publishers to expand our digital resource collection. Members now have access to over 50 new research databases and thousands of academic journals.</p>
                        <div class="blog-card-footer">
                            <div class="blog-card-author">
                                <img src="{% static 'images/testimonials/user3.jpg' %}" alt="Author" onerror="this.src='https://placehold.co/50x50?text=ER'">
                                <span>Emily Rodriguez</span>
                            </div>
                            <a href="#" class="blog-card-link">Read More <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4" data-aos="fade-up">
            <a href="#" class="btn btn-outline-primary btn-lg hover-float">
                View All Articles <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</div>

<!-- Floating Contact Button -->
<div class="floating-contact-button">
    <button class="contact-toggle-btn" id="contactToggleBtn">
        <i class="fas fa-comments"></i>
    </button>
    <div class="contact-popup" id="contactPopup">
        <div class="contact-popup-header">
            <h5>Contact Us</h5>
            <button class="contact-close-btn" id="contactCloseBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="contact-popup-body">
            <p>Have questions? We're here to help!</p>
            <div class="contact-options">
                <a href="tel:+1234567890" class="contact-option">
                    <i class="fas fa-phone"></i>
                    <span>Call Us</span>
                </a>
                <a href="mailto:support@library.com" class="contact-option">
                    <i class="fas fa-envelope"></i>
                    <span>Email</span>
                </a>
                <a href="#" class="contact-option">
                    <i class="fas fa-comment-dots"></i>
                    <span>Live Chat</span>
                </a>
            </div>
            <form class="contact-form mt-3">
                <div class="mb-3">
                    <input type="text" class="form-control" placeholder="Your Name" required>
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" placeholder="Your Email" required>
                </div>
                <div class="mb-3">
                    <textarea class="form-control" rows="3" placeholder="Your Message" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">Send Message</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Particles.js for hero section with theme-compatible colors
        if (document.getElementById('hero-particles')) {
            // Get current theme colors
            const root = document.documentElement;
            const textColor = getComputedStyle(root).getPropertyValue('--text-color').trim();

            // Create particles configuration
            const particlesConfig = {
                "particles": {
                    "number": {
                        "value": 80,
                        "density": {
                            "enable": true,
                            "value_area": 800
                        }
                    },
                    "color": {
                        "value": textColor || "#ffffff"
                    },
                    "shape": {
                        "type": "circle",
                        "stroke": {
                            "width": 0,
                            "color": "#000000"
                        },
                        "polygon": {
                            "nb_sides": 5
                        }
                    },
                    "opacity": {
                        "value": 0.3,
                        "random": true,
                        "anim": {
                            "enable": true,
                            "speed": 1,
                            "opacity_min": 0.1,
                            "sync": false
                        }
                    },
                    "size": {
                        "value": 3,
                        "random": true,
                        "anim": {
                            "enable": true,
                            "speed": 2,
                            "size_min": 0.1,
                            "sync": false
                        }
                    },
                    "line_linked": {
                        "enable": true,
                        "distance": 150,
                        "color": textColor || "#ffffff",
                        "opacity": 0.2,
                        "width": 1
                    },
                    "move": {
                        "enable": true,
                        "speed": 1,
                        "direction": "none",
                        "random": true,
                        "straight": false,
                        "out_mode": "out",
                        "bounce": false,
                        "attract": {
                            "enable": false,
                            "rotateX": 600,
                            "rotateY": 1200
                        }
                    }
                },
                "interactivity": {
                    "detect_on": "canvas",
                    "events": {
                        "onhover": {
                            "enable": true,
                            "mode": "grab"
                        },
                        "onclick": {
                            "enable": true,
                            "mode": "push"
                        },
                        "resize": true
                    },
                    "modes": {
                        "grab": {
                            "distance": 140,
                            "line_linked": {
                                "opacity": 0.5
                            }
                        },
                        "push": {
                            "particles_nb": 4
                        }
                    }
                },
                "retina_detect": true
            };

            // Initialize particles
            particlesJS('hero-particles', particlesConfig);

            // Update particles when theme changes
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'data-bs-theme' ||
                        mutation.attributeName === 'class' && mutation.target.classList.contains('theme-change')) {

                        // Get updated text color
                        const updatedTextColor = getComputedStyle(root).getPropertyValue('--text-color').trim();

                        // Destroy and recreate particles with new color
                        if (window.pJSDom && window.pJSDom.length > 0) {
                            // Update particles color
                            window.pJSDom[0].pJS.particles.color.value = updatedTextColor;
                            window.pJSDom[0].pJS.particles.line_linked.color = updatedTextColor;

                            // Refresh particles
                            window.pJSDom[0].pJS.fn.particlesRefresh();
                        }
                    }
                });
            });

            // Observe theme changes on html and body elements
            observer.observe(document.documentElement, { attributes: true });
            observer.observe(document.body, { attributes: true });
        }

        // Initialize Typed.js with enhanced options
        new Typed('.typed-text', {
            strings: [
                'Discover World-Class Library Network',
                'Access 10+ Million Books Instantly',
                'Experience AI-Powered Recommendations',
                'Join Our Global Reading Community'
            ],
            typeSpeed: 50,
            backSpeed: 30,
            backDelay: 2000,
            loop: true,
            cursorChar: '|',
            fadeOut: true,
            smartBackspace: true
        });

        // Enhanced counter animation with comma formatting and easing
        const counterElements = document.querySelectorAll('.counter');
        counterElements.forEach(counter => {
            const target = parseInt(counter.textContent.replace(/,/g, ''));
            const duration = 2500; // 2.5 seconds
            const frameDuration = 1000 / 60; // 60fps
            const totalFrames = Math.round(duration / frameDuration);
            // Enhanced easing function for more dynamic animation
            const easeOutExpo = t => (t === 1) ? 1 : 1 - Math.pow(2, -10 * t);
            let frame = 0;

            // Start with 0
            counter.textContent = '0';

            // Create counter animation
            const animate = () => {
                frame++;
                // Calculate progress using enhanced easing function
                const progress = easeOutExpo(frame / totalFrames);
                // Calculate current count
                const currentCount = Math.round(target * progress);
                // Format with commas
                counter.textContent = currentCount.toLocaleString();

                // Continue animation if not complete
                if (frame < totalFrames) {
                    requestAnimationFrame(animate);
                } else {
                    // Add a subtle pulse animation when counter completes
                    counter.classList.add('pulse-once');
                    setTimeout(() => {
                        counter.classList.remove('pulse-once');
                    }, 1000);
                }
            };

            // Create Intersection Observer to start animation when counter is visible
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            requestAnimationFrame(animate);
                        }, 300);
                        observer.unobserve(counter);
                    }
                });
            }, { threshold: 0.2 });

            observer.observe(counter);
        });

        // Enhanced progress bars animation with intersection observer
        const progressBars = document.querySelectorAll('.progress-bar');
        progressBars.forEach(progressBar => {
            const width = progressBar.style.width;
            progressBar.style.width = '0';

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            progressBar.style.width = width;
                        }, 300);
                        observer.unobserve(progressBar);
                    }
                });
            }, { threshold: 0.2 });

            observer.observe(progressBar);
        });

        // Initialize 3D Book Carousel with enhanced effects
        new Swiper('.book-carousel-3d', {
            slidesPerView: 1,
            spaceBetween: 30,
            loop: true,
            speed: 800,
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            effect: 'coverflow',
            coverflowEffect: {
                rotate: 15,
                stretch: 0,
                depth: 300,
                modifier: 1.5,
                slideShadows: true,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                dynamicBullets: true
            },
            breakpoints: {
                640: {
                    slidesPerView: 2
                },
                768: {
                    slidesPerView: 3
                },
                1024: {
                    slidesPerView: 4
                }
            },
            on: {
                slideChange: function() {
                    // Add subtle animation to active slide
                    setTimeout(() => {
                        const activeSlide = document.querySelector('.book-carousel-3d .swiper-slide-active');
                        if (activeSlide) {
                            activeSlide.classList.add('scale-up-center');
                            setTimeout(() => {
                                activeSlide.classList.remove('scale-up-center');
                            }, 500);
                        }
                    }, 100);
                }
            }
        });

        // Custom navigation for book carousel with enhanced feedback
        document.querySelector('.swiper-button-next-custom')?.addEventListener('click', function() {
            this.classList.add('button-pulse');
            setTimeout(() => {
                this.classList.remove('button-pulse');
            }, 300);
            const swiper = document.querySelector('.book-carousel-3d').swiper;
            swiper.slideNext();
        });

        document.querySelector('.swiper-button-prev-custom')?.addEventListener('click', function() {
            this.classList.add('button-pulse');
            setTimeout(() => {
                this.classList.remove('button-pulse');
            }, 300);
            const swiper = document.querySelector('.book-carousel-3d').swiper;
            swiper.slidePrev();
        });

        // Initialize Steps Carousel for How It Works section
        const stepsCarousel = new Swiper('.steps-carousel', {
            slidesPerView: 1,
            spaceBetween: 30,
            speed: 800,
            autoplay: {
                delay: 8000,
                disableOnInteraction: false,
            },
            effect: 'fade',
            fadeEffect: {
                crossFade: true
            },
            pagination: {
                el: '.steps-pagination',
                clickable: true,
                renderBullet: function (index, className) {
                    return '<span class="' + className + '">' + (index + 1) + '</span>';
                },
            },
            navigation: {
                nextEl: '.steps-button-next',
                prevEl: '.steps-button-prev',
            },
            on: {
                slideChange: function() {
                    // Update timeline nodes
                    const nodes = document.querySelectorAll('.timeline-node');
                    nodes.forEach((node, index) => {
                        if (index <= this.activeIndex) {
                            node.classList.add('active');
                        } else {
                            node.classList.remove('active');
                        }
                    });

                    // Update timeline progress
                    const progress = document.querySelector('.timeline-progress-indicator');
                    if (progress) {
                        const percentage = ((this.activeIndex + 1) / nodes.length) * 100;
                        progress.style.width = percentage + '%';
                    }
                }
            }
        });

        // Timeline nodes click functionality
        const timelineNodes = document.querySelectorAll('.timeline-node');
        timelineNodes.forEach((node, index) => {
            node.addEventListener('click', function() {
                stepsCarousel.slideTo(index);
            });
        });

        // Initialize premium testimonials carousel with enhanced effects
        new Swiper('.testimonials-carousel-premium', {
            slidesPerView: 1,
            spaceBetween: 30,
            loop: true,
            speed: 800,
            autoplay: {
                delay: 6000,
                disableOnInteraction: false,
            },
            effect: 'creative',
            creativeEffect: {
                prev: {
                    translate: ['-100%', 0, -500],
                    opacity: 0,
                    scale: 0.8
                },
                next: {
                    translate: ['100%', 0, -500],
                    opacity: 0,
                    scale: 0.8
                },
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                dynamicBullets: true
            },
            breakpoints: {
                992: {
                    slidesPerView: 2,
                    spaceBetween: 40
                }
            }
        });

        // Custom navigation for testimonials carousel with enhanced feedback
        document.querySelector('.swiper-button-next-premium')?.addEventListener('click', function() {
            this.classList.add('button-pulse');
            setTimeout(() => {
                this.classList.remove('button-pulse');
            }, 300);
            const swiper = document.querySelector('.testimonials-carousel-premium').swiper;
            swiper.slideNext();
        });

        document.querySelector('.swiper-button-prev-premium')?.addEventListener('click', function() {
            this.classList.add('button-pulse');
            setTimeout(() => {
                this.classList.remove('button-pulse');
            }, 300);
            const swiper = document.querySelector('.testimonials-carousel-premium').swiper;
            swiper.slidePrev();
        });

        // Initialize partners carousel with enhanced effects
        new Swiper('.partners-carousel', {
            slidesPerView: 2,
            spaceBetween: 30,
            loop: true,
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            },
            breakpoints: {
                576: {
                    slidesPerView: 3
                },
                768: {
                    slidesPerView: 4
                },
                992: {
                    slidesPerView: 5
                },
                1200: {
                    slidesPerView: 6
                }
            }
        });

        // Library view toggle functionality with enhanced feedback
        const gridViewBtn = document.getElementById('grid-view-btn');
        const mapViewBtn = document.getElementById('map-view-btn');
        const gridView = document.querySelector('.libraries-grid-view');
        const mapView = document.querySelector('.libraries-map-view');

        if (gridViewBtn && mapViewBtn) {
            gridViewBtn.addEventListener('click', function() {
                gridViewBtn.classList.add('active');
                mapViewBtn.classList.remove('active');
                gridView.classList.add('active');
                mapView.classList.remove('active');

                // Add transition effect
                gridView.classList.add('fade-in');
                setTimeout(() => {
                    gridView.classList.remove('fade-in');
                }, 500);
            });

            mapViewBtn.addEventListener('click', function() {
                mapViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
                mapView.classList.add('active');
                gridView.classList.remove('active');

                // Add transition effect
                mapView.classList.add('fade-in');
                setTimeout(() => {
                    mapView.classList.remove('fade-in');
                }, 500);
            });
        }

        // Enhanced Premium Newsletter form handling with improved validation and animations
        const newsletterFormPremium = document.getElementById('newsletterFormPremium');
        if (newsletterFormPremium) {
            newsletterFormPremium.addEventListener('submit', function(e) {
                e.preventDefault();
                const nameInput = this.querySelector('#nameInput');
                const emailInput = this.querySelector('#emailInput');
                const interestSelect = this.querySelector('#interestSelect');
                const privacyCheck = this.querySelector('#privacyCheck');

                // Enhanced validation
                let isValid = true;

                if (!nameInput.value) {
                    nameInput.classList.add('is-invalid');
                    isValid = false;
                    // Add floating validation message
                    showValidationMessage(nameInput, 'Please enter your name');
                }

                if (!emailInput.value || !emailInput.value.includes('@')) {
                    emailInput.classList.add('is-invalid');
                    isValid = false;
                    // Add floating validation message
                    showValidationMessage(emailInput, 'Please enter a valid email address');
                }

                if (!interestSelect.value) {
                    interestSelect.classList.add('is-invalid');
                    isValid = false;
                    // Add floating validation message
                    showValidationMessage(interestSelect, 'Please select your interests');
                }

                if (privacyCheck && !privacyCheck.checked) {
                    privacyCheck.classList.add('is-invalid');
                    isValid = false;
                    // Add floating validation message
                    showValidationMessage(privacyCheck, 'Please accept the privacy policy');
                }

                if (isValid) {
                    // Show loading state
                    const submitBtn = this.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
                    submitBtn.disabled = true;

                    // Simulate server request
                    setTimeout(() => {
                        // Show success message with enhanced animation
                        this.innerHTML = `
                            <div class="newsletter-success-premium animate__animated animate__fadeIn">
                                <div class="success-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="success-confetti"></div>
                                <h4>Welcome to Our Community, ${nameInput.value}!</h4>
                                <p>You've been successfully subscribed to our premium newsletter.</p>
                                <p>We've sent a confirmation email to <strong>${emailInput.value}</strong>.</p>
                                <p class="mt-3">You'll start receiving updates about <strong>${interestSelect.options[interestSelect.selectedIndex].text}</strong> and other library news.</p>
                                <div class="mt-4 success-benefits">
                                    <div class="benefit-item">
                                        <i class="fas fa-gift"></i>
                                        <span>Exclusive Content</span>
                                    </div>
                                    <div class="benefit-item">
                                        <i class="fas fa-tag"></i>
                                        <span>Special Offers</span>
                                    </div>
                                    <div class="benefit-item">
                                        <i class="fas fa-bell"></i>
                                        <span>Event Invitations</span>
                                    </div>
                                </div>
                            </div>
                        `;

                        // Log subscription data
                        console.log('Subscription data:', {
                            name: nameInput.value,
                            email: emailInput.value,
                            interest: interestSelect.value
                        });
                    }, 1500);
                } else {
                    // Add shake animation to form with enhanced effect
                    newsletterFormPremium.classList.add('animate__animated', 'animate__shakeX');
                    setTimeout(() => {
                        newsletterFormPremium.classList.remove('animate__animated', 'animate__shakeX');
                    }, 800);
                }
            });

            // Helper function to show validation messages
            function showValidationMessage(element, message) {
                // Remove any existing message
                const existingMessage = element.parentElement.querySelector('.validation-message');
                if (existingMessage) {
                    existingMessage.remove();
                }

                // Create and add new message
                const messageElement = document.createElement('div');
                messageElement.className = 'validation-message animate__animated animate__fadeIn';
                messageElement.innerHTML = message;
                element.parentElement.appendChild(messageElement);

                // Remove message after 3 seconds
                setTimeout(() => {
                    messageElement.classList.add('animate__fadeOut');
                    setTimeout(() => {
                        messageElement.remove();
                    }, 500);
                }, 3000);
            }

            // Remove invalid class on input with enhanced feedback
            const formInputs = newsletterFormPremium.querySelectorAll('input, select');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.remove('is-invalid');
                    // Add subtle highlight effect
                    this.classList.add('input-highlight');
                });

                input.addEventListener('blur', function() {
                    this.classList.remove('input-highlight');
                });

                // Live validation
                input.addEventListener('input', function() {
                    if (this.value) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else {
                        this.classList.remove('is-valid');
                    }
                });
            });
        }

        // Initialize enhanced tooltips with custom animation
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl, {
                animation: true,
                delay: { show: 100, hide: 100 },
                template: '<div class="tooltip tooltip-premium" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'
            });
        });

        // Enhanced scroll reveal animation with more sophisticated effects
        const premiumElements = document.querySelectorAll(
            '.section-header, .stat-card-premium, .book-card-premium, .step-card-premium, ' +
            '.library-card-premium, .testimonial-card-premium, .newsletter-wrapper-premium, ' +
            '.app-mockup-container, .app-content, .partner-item, .featured-book-spotlight, ' +
            '.stats-highlight-box, .category-placeholder'
        );

        // Use Intersection Observer for better performance
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.15
        };

        const elementObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const element = entry.target;

                    // Determine animation based on element type
                    let animationClass = 'animate__fadeInUp';

                    if (element.classList.contains('stat-card-premium')) {
                        animationClass = 'animate__zoomIn';
                    } else if (element.classList.contains('featured-book-spotlight')) {
                        animationClass = 'animate__fadeIn';
                    } else if (element.classList.contains('step-card-premium')) {
                        animationClass = 'animate__fadeInRight';
                    } else if (element.classList.contains('library-card-premium')) {
                        animationClass = 'animate__fadeInUp';
                    }

                    // Add animation with delay based on index
                    setTimeout(() => {
                        element.classList.add('animate__animated', animationClass);
                    }, 100);

                    // Stop observing after animation
                    observer.unobserve(element);
                }
            });
        }, observerOptions);

        // Start observing elements
        premiumElements.forEach(element => {
            elementObserver.observe(element);
        });

        // Enhanced parallax effect for hero section with mouse movement
        const heroSection = document.querySelector('.hero-section');
        const heroShapes = document.querySelectorAll('.hero-shapes-modern .shape');
        const heroImage = document.querySelector('.hero-image-3d');

        if (heroSection && heroShapes.length) {
            // Scroll parallax
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset;
                const heroHeight = heroSection.offsetHeight;
                const scrollPercentage = Math.min(scrollTop / heroHeight, 1);

                heroShapes.forEach((shape, index) => {
                    const speed = 0.2 + (index * 0.1);
                    const yPos = scrollPercentage * speed * 100;
                    shape.style.transform = `translateY(${yPos}px) rotate(${yPos / 10}deg)`;
                });
            });

            // Mouse movement parallax
            heroSection.addEventListener('mousemove', function(e) {
                const xPos = (e.clientX / window.innerWidth - 0.5) * 20;
                const yPos = (e.clientY / window.innerHeight - 0.5) * 20;

                heroShapes.forEach((shape, index) => {
                    const speed = 0.5 + (index * 0.2);
                    shape.style.transform = `translate(${xPos * speed}px, ${yPos * speed}px)`;
                });

                if (heroImage) {
                    heroImage.style.transform = `translate(${xPos * 0.3}px, ${yPos * 0.3}px) rotateY(${xPos * 0.2}deg) rotateX(${-yPos * 0.2}deg)`;
                }
            });
        }

        // Enhanced smooth scroll for hero scroll indicator with animation
        const scrollIndicator = document.querySelector('.hero-scroll-indicator');
        if (scrollIndicator) {
            // Add pulse animation
            setInterval(() => {
                scrollIndicator.classList.add('pulse');
                setTimeout(() => {
                    scrollIndicator.classList.remove('pulse');
                }, 1000);
            }, 3000);

            scrollIndicator.addEventListener('click', function() {
                const statsSection = document.querySelector('.stats-section');
                if (statsSection) {
                    // Add click feedback
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);

                    // Smooth scroll with enhanced behavior
                    window.scrollTo({
                        top: statsSection.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        }

        // Function to update theme-dependent elements
        function updateThemeElements() {
            // Get current theme colors
            const root = document.documentElement;
            const buttonColor = getComputedStyle(root).getPropertyValue('--button-color').trim();
            const accentColor = getComputedStyle(root).getPropertyValue('--accent-color').trim();
            const buttonColorRgb = getComputedStyle(root).getPropertyValue('--button-color-rgb').trim();
            const accentColorRgb = getComputedStyle(root).getPropertyValue('--accent-color-rgb').trim();
            const textColorRgb = getComputedStyle(root).getPropertyValue('--text-color-rgb').trim();

            // Update gradient backgrounds
            const gradientElements = document.querySelectorAll('.category-icon, .stats-highlight-icon, .step-number-badge, .featured-book-badge span, .stat-card-badge, .steps-button-prev, .steps-button-next, .steps-pagination .swiper-pagination-bullet-active, .timeline-node.active, .step-icon, .benefit-icon, .hero-image-badge');
            gradientElements.forEach(element => {
                element.style.background = `linear-gradient(135deg, ${buttonColor} 0%, ${accentColor} 100%)`;
                element.style.boxShadow = `0 5px 15px rgba(${buttonColorRgb}, 0.3)`;
            });

            // Update glow effects
            const glowElements = document.querySelectorAll('.hero-image-glow, .book-cover-glow, .featured-book-glow, .stat-card-glow');
            glowElements.forEach(element => {
                element.style.background = `radial-gradient(circle at center, rgba(${buttonColorRgb}, 0.5), transparent 70%)`;
            });

            // Update color elements
            const colorElements = document.querySelectorAll('.step-arrow, .swiper-button-prev-custom, .swiper-button-next-custom');
            colorElements.forEach(element => {
                element.style.color = buttonColor;
            });

            // Update newsletter form container
            const newsletterFormContainer = document.querySelector('.newsletter-form-container-premium');
            if (newsletterFormContainer) {
                newsletterFormContainer.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
            }

            // Update step card inner
            const stepCardInner = document.querySelectorAll('.step-card-inner');
            stepCardInner.forEach(element => {
                element.style.boxShadow = `0 10px 30px rgba(${textColorRgb}, 0.08)`;
            });

            // Update hero video overlay
            const heroVideoOverlay = document.querySelector('.hero-video-overlay');
            if (heroVideoOverlay) {
                heroVideoOverlay.style.background = `linear-gradient(135deg, rgba(${buttonColorRgb}, 0.9) 0%, rgba(${accentColorRgb}, 0.9) 100%)`;
            }

            // Update 3D primary buttons
            const btn3dPrimary = document.querySelectorAll('.btn-3d-primary');
            if (btn3dPrimary.length > 0) {
                btn3dPrimary.forEach(button => {
                    button.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
                    button.style.boxShadow = `0 10px 20px rgba(${buttonColorRgb}, 0.3), 0 6px 6px rgba(${buttonColorRgb}, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset`;
                });
            }

            // Update text gradient
            const textGradient = document.querySelectorAll('.text-gradient-primary');
            if (textGradient.length > 0) {
                textGradient.forEach(element => {
                    element.style.background = `linear-gradient(to right, #fff, ${accentColor})`;
                    element.style.webkitBackgroundClip = 'text';
                    element.style.backgroundClip = 'text';
                    element.style.webkitTextFillColor = 'transparent';
                });
            }
        }

        // Update theme elements on initial load
        updateThemeElements();

        // Update navigation buttons on initial load
        const testimonialNavButtons = document.querySelectorAll('.testimonial-navigation .swiper-button-next, .testimonial-navigation .swiper-button-prev');
        if (testimonialNavButtons.length > 0) {
            const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
            testimonialNavButtons.forEach(button => {
                button.style.backgroundColor = buttonColor;
            });
        }

        // Update swiper buttons on initial load
        const swiperButtons = document.querySelectorAll('.swiper-button-prev-custom, .swiper-button-next-custom');
        if (swiperButtons.length > 0) {
            const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
            const cardBackground = getComputedStyle(document.documentElement).getPropertyValue('--card-background').trim();
            swiperButtons.forEach(button => {
                button.style.color = buttonColor;
                button.style.backgroundColor = cardBackground;
            });
        }

        // Update hero section elements on initial load
        const heroVideoOverlay = document.querySelector('.hero-video-overlay');
        if (heroVideoOverlay) {
            const buttonColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--button-color-rgb').trim();
            const accentColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--accent-color-rgb').trim();
            heroVideoOverlay.style.background = `linear-gradient(135deg, rgba(${buttonColorRgb}, 0.9) 0%, rgba(${accentColorRgb}, 0.9) 100%)`;
        }

        // Update hero image badge on initial load
        const heroImageBadge = document.querySelector('.hero-image-badge');
        if (heroImageBadge) {
            const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
            heroImageBadge.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
        }

        // Update 3D primary buttons on initial load
        const btn3dPrimary = document.querySelectorAll('.btn-3d-primary');
        if (btn3dPrimary.length > 0) {
            const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
            const buttonColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--button-color-rgb').trim();
            btn3dPrimary.forEach(button => {
                button.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
                button.style.boxShadow = `0 10px 20px rgba(${buttonColorRgb}, 0.3), 0 6px 6px rgba(${buttonColorRgb}, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset`;
            });
        }

        // Update text gradient on initial load
        const textGradient = document.querySelectorAll('.text-gradient-primary');
        if (textGradient.length > 0) {
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
            textGradient.forEach(element => {
                element.style.background = `linear-gradient(to right, #fff, ${accentColor})`;
                element.style.webkitBackgroundClip = 'text';
                element.style.backgroundClip = 'text';
                element.style.webkitTextFillColor = 'transparent';
            });
        }

        // Update theme elements when theme changes
        document.addEventListener('themeChanged', function() {
            updateThemeElements();

            // Update testimonial navigation buttons
            const testimonialNavButtons = document.querySelectorAll('.testimonial-navigation .swiper-button-next, .testimonial-navigation .swiper-button-prev');
            if (testimonialNavButtons.length > 0) {
                const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
                testimonialNavButtons.forEach(button => {
                    button.style.backgroundColor = buttonColor;
                });
            }

            // Update swiper buttons
            const swiperButtons = document.querySelectorAll('.swiper-button-prev-custom, .swiper-button-next-custom');
            if (swiperButtons.length > 0) {
                const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
                const cardBackground = getComputedStyle(document.documentElement).getPropertyValue('--card-background').trim();
                swiperButtons.forEach(button => {
                    button.style.color = buttonColor;
                    button.style.backgroundColor = cardBackground;
                });
            }

            // Update hero section elements
            const heroVideoOverlay = document.querySelector('.hero-video-overlay');
            if (heroVideoOverlay) {
                const buttonColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--button-color-rgb').trim();
                const accentColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--accent-color-rgb').trim();
                heroVideoOverlay.style.background = `linear-gradient(135deg, rgba(${buttonColorRgb}, 0.9) 0%, rgba(${accentColorRgb}, 0.9) 100%)`;
            }

            // Update hero image badge
            const heroImageBadge = document.querySelector('.hero-image-badge');
            if (heroImageBadge) {
                const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
                const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
                heroImageBadge.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
            }

            // Update 3D primary buttons
            const btn3dPrimary = document.querySelectorAll('.btn-3d-primary');
            if (btn3dPrimary.length > 0) {
                const buttonColor = getComputedStyle(document.documentElement).getPropertyValue('--button-color').trim();
                const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
                const buttonColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--button-color-rgb').trim();
                btn3dPrimary.forEach(button => {
                    button.style.background = `linear-gradient(145deg, ${buttonColor}, ${accentColor})`;
                    button.style.boxShadow = `0 10px 20px rgba(${buttonColorRgb}, 0.3), 0 6px 6px rgba(${buttonColorRgb}, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset`;
                });
            }

            // Update text gradient
            const textGradient = document.querySelectorAll('.text-gradient-primary');
            if (textGradient.length > 0) {
                const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
                textGradient.forEach(element => {
                    element.style.background = `linear-gradient(to right, #fff, ${accentColor})`;
                    element.style.webkitBackgroundClip = 'text';
                    element.style.backgroundClip = 'text';
                    element.style.webkitTextFillColor = 'transparent';
                });
            }
        });

        // Listen for theme changes
        const themeObserver = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'data-bs-theme' ||
                    (mutation.attributeName === 'class' &&
                     (mutation.target.classList.contains('theme-classic-light') ||
                      mutation.target.classList.contains('theme-elegant-dark') ||
                      mutation.target.classList.contains('theme-earthy') ||
                      mutation.target.classList.contains('theme-royal-purple') ||
                      mutation.target.classList.contains('theme-ocean-blue')))) {

                    // Dispatch custom event
                    document.dispatchEvent(new CustomEvent('themeChanged'));

                    // Update theme elements
                    updateThemeElements();
                }
            });
        });

        // Observe theme changes on html and body elements
        themeObserver.observe(document.documentElement, { attributes: true });
        themeObserver.observe(document.body, { attributes: true });

        // Enhanced Floating Contact Button with animations
        const contactToggleBtn = document.getElementById('contactToggleBtn');
        const contactCloseBtn = document.getElementById('contactCloseBtn');
        const contactPopup = document.getElementById('contactPopup');

        if (contactToggleBtn && contactPopup) {
            // Add initial animation
            setTimeout(() => {
                contactToggleBtn.classList.add('animate__animated', 'animate__bounceIn');
                setTimeout(() => {
                    contactToggleBtn.classList.remove('animate__animated', 'animate__bounceIn');

                    // Add attention animation after 5 seconds
                    setTimeout(() => {
                        contactToggleBtn.classList.add('animate__animated', 'animate__heartBeat');
                        setTimeout(() => {
                            contactToggleBtn.classList.remove('animate__animated', 'animate__heartBeat');
                        }, 1000);
                    }, 5000);
                }, 1000);
            }, 2000);

            contactToggleBtn.addEventListener('click', function() {
                contactPopup.classList.toggle('active');
                contactToggleBtn.classList.toggle('active');

                if (contactPopup.classList.contains('active')) {
                    contactPopup.classList.add('animate__animated', 'animate__fadeInUp');
                    setTimeout(() => {
                        contactPopup.classList.remove('animate__animated', 'animate__fadeInUp');
                    }, 500);
                } else {
                    contactPopup.classList.add('animate__animated', 'animate__fadeOutDown');
                    setTimeout(() => {
                        contactPopup.classList.remove('animate__animated', 'animate__fadeOutDown');
                    }, 500);
                }
            });
        }

        if (contactCloseBtn && contactPopup) {
            contactCloseBtn.addEventListener('click', function() {
                contactPopup.classList.add('animate__animated', 'animate__fadeOutDown');
                setTimeout(() => {
                    contactPopup.classList.remove('active');
                    contactPopup.classList.remove('animate__animated', 'animate__fadeOutDown');
                    contactToggleBtn.classList.remove('active');
                }, 500);
            });
        }

        // Close contact popup when clicking outside with enhanced animation
        document.addEventListener('click', function(event) {
            if (contactPopup && contactToggleBtn) {
                const isClickInside = contactPopup.contains(event.target) || contactToggleBtn.contains(event.target);
                if (!isClickInside && contactPopup.classList.contains('active')) {
                    contactPopup.classList.add('animate__animated', 'animate__fadeOutDown');
                    setTimeout(() => {
                        contactPopup.classList.remove('active');
                        contactPopup.classList.remove('animate__animated', 'animate__fadeOutDown');
                        contactToggleBtn.classList.remove('active');
                    }, 500);
                }
            }
        });

        // Enhanced contact form submission with validation and animations
        const contactForm = document.querySelector('.contact-form');
        if (contactForm) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();

                // Validate form
                const nameInput = this.querySelector('input[type="text"]');
                const emailInput = this.querySelector('input[type="email"]');
                const messageInput = this.querySelector('textarea');
                let isValid = true;

                if (!nameInput.value) {
                    nameInput.classList.add('is-invalid');
                    isValid = false;
                }

                if (!emailInput.value || !emailInput.value.includes('@')) {
                    emailInput.classList.add('is-invalid');
                    isValid = false;
                }

                if (!messageInput.value) {
                    messageInput.classList.add('is-invalid');
                    isValid = false;
                }

                if (isValid) {
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');

                    // Show loading state
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
                    submitBtn.disabled = true;

                    // Simulate server request
                    setTimeout(() => {
                        // Show enhanced success message with animation
                        this.innerHTML = `
                            <div class="text-center py-4 animate__animated animate__fadeIn">
                                <div class="success-icon mb-3">
                                    <i class="fas fa-check-circle fa-3x text-success"></i>
                                </div>
                                <h5>Message Sent Successfully!</h5>
                                <p>Thank you for reaching out. Our team will respond to your inquiry within 24 hours.</p>
                                <div class="success-actions mt-4">
                                    <button class="btn btn-sm btn-outline-primary new-message-btn">
                                        <i class="fas fa-pen me-2"></i>Send Another Message
                                    </button>
                                </div>
                            </div>
                        `;

                        // Add event listener to "Send Another Message" button
                        const newMessageBtn = document.querySelector('.new-message-btn');
                        if (newMessageBtn) {
                            newMessageBtn.addEventListener('click', function() {
                                contactForm.innerHTML = `
                                    <div class="mb-3">
                                        <input type="text" class="form-control" placeholder="Your Name" required>
                                    </div>
                                    <div class="mb-3">
                                        <input type="email" class="form-control" placeholder="Your Email" required>
                                    </div>
                                    <div class="mb-3">
                                        <textarea class="form-control" rows="3" placeholder="Your Message" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Send Message</button>
                                `;
                            });
                        }

                        // Log form data
                        console.log('Contact form submitted:', Object.fromEntries(formData));
                    }, 1500);
                } else {
                    // Add shake animation to form
                    contactForm.classList.add('animate__animated', 'animate__shakeX');
                    setTimeout(() => {
                        contactForm.classList.remove('animate__animated', 'animate__shakeX');
                    }, 800);
                }
            });

            // Live validation for contact form
            const formInputs = contactForm.querySelectorAll('input, textarea');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.remove('is-invalid');
                });

                input.addEventListener('input', function() {
                    if (this.value) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else {
                        this.classList.remove('is-valid');
                    }
                });
            });
        }
    });
</script>
{% endblock %}
